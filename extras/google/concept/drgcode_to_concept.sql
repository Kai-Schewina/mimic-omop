-- generates drgcode_to_concept file
\copy (with"d_drg" AS ( SELECT distinct description FROM mimiciii.drgcodes),"direct" AS (SELECT d_drg.description, c.*  FROM d_drg  join omop.concept c    ON description   = concept_name),"indirect" AS (SELECT d_drg.description, c3.*  FROM d_drg  join omop.concept c    ON description   = concept_name  LEFT   JOIN omop.concept_relationship c2    ON concept_id_1  = c.concept_id AND c2.relationship_id = 'DRG - MS-DRG eq'  LEFT   JOIN omop.concept c3    ON c3.concept_id = c2.concept_id_2),"combined" AS (SELECT * FROM directUNION ALLSELECT * FROM indirect),"total" AS (SELECT description, concept_idFROM combinedWHERE standard_concept = 'S'UNION ALLSELECT description, null::integerFROM d_drg),"ord" as (select *, row_number() over() as rn from total)SELECT distinct on (description) description, concept_idFROM ord ORDER BY description, rn ASC) TO '/tmp/drgcode_to_concept.csv' CSV HEADER ;

